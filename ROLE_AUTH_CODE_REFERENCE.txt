// ============================================================================
// ROLE-BASED AUTH SYSTEM - QUICK CODE REFERENCE
// ============================================================================

// FILE 1: src/context/AuthContext.jsx
// ============================================================================
import { createContext, useState, useEffect } from 'react'

export const AuthContext = createContext()

const API_BASE_URL = 'http://localhost:5000/api/v1'

export function AuthProvider({ children }) {
  const [user, setUser] = useState(null)
  const [loading, setLoading] = useState(true)
  const [error, setError] = useState(null)

  // Initialize from localStorage
  useEffect(() => {
    const token = localStorage.getItem('token')
    const storedUser = localStorage.getItem('user')
    if (token && storedUser) {
      setUser(JSON.parse(storedUser))
    }
    setLoading(false)
  }, [])

  // Login with role parameter
  const login = async (email, password, role = 'Visitor') => {
    setLoading(true)
    setError(null)
    try {
      const response = await fetch(`${API_BASE_URL}/auth/login`, {
        method: 'POST',
        headers: { 'Content-Type': 'application/json' },
        body: JSON.stringify({ email, password }),
      })
      if (!response.ok) throw new Error('Login failed')
      
      const data = await response.json()
      const userData = { ...data.user, role: role || data.user.role || 'Visitor' }
      
      localStorage.setItem('token', data.token)
      localStorage.setItem('user', JSON.stringify(userData))
      setUser(userData)
      return userData
    } catch (err) {
      setError(err.message)
      throw err
    } finally {
      setLoading(false)
    }
  }

  // Register with role parameter
  const register = async (name, email, password, role = 'Visitor', mobile = '') => {
    setLoading(true)
    setError(null)
    try {
      const response = await fetch(`${API_BASE_URL}/auth/register`, {
        method: 'POST',
        headers: { 'Content-Type': 'application/json' },
        body: JSON.stringify({ name, email, password, mobile, role: role.toUpperCase() }),
      })
      if (!response.ok) throw new Error('Registration failed')
      
      const data = await response.json()
      const userData = { ...data.user, role }
      
      localStorage.setItem('token', data.token)
      localStorage.setItem('user', JSON.stringify(userData))
      setUser(userData)
      return userData
    } catch (err) {
      setError(err.message)
      throw err
    } finally {
      setLoading(false)
    }
  }

  const logout = () => {
    localStorage.removeItem('token')
    localStorage.removeItem('user')
    setUser(null)
    setError(null)
  }

  const clearError = () => setError(null)

  return (
    <AuthContext.Provider value={{ user, loading, error, login, register, logout, clearError }}>
      {children}
    </AuthContext.Provider>
  )
}

// ============================================================================
// FILE 2: src/pages/Home.jsx - Key Sections
// ============================================================================

// Role definitions
const ROLES = [
  { id: 'Visitor', label: 'Visitor', icon: 'ðŸ‘¤', description: 'Browse & collect art' },
  { id: 'Artist', label: 'Creator', icon: 'ðŸŽ¨', description: 'Upload your artwork' },
  { id: 'Curator', label: 'Curator', icon: 'ðŸ–¼ï¸', description: 'Curate exhibitions' },
  { id: 'Admin', label: 'Admin', icon: 'âš™ï¸', description: 'Manage platform' },
]

// State management
const [selectedRole, setSelectedRole] = useState('Visitor')
const [isLogin, setIsLogin] = useState(true)

// Handle login with role
const handleLogin = async (e) => {
  e.preventDefault()
  try {
    const userData = await login(loginForm.email, loginForm.password, selectedRole)
    
    const rolePath = {
      'Admin': '/admin',
      'Artist': '/artist',
      'Visitor': '/visitor',
      'Curator': '/curator',
    }[userData.role]
    
    navigate(rolePath)
  } catch (err) {
    setError(err.message)
  }
}

// Handle register with role
const handleRegister = async (e) => {
  e.preventDefault()
  try {
    const userData = await register(
      registerForm.name,
      registerForm.email,
      registerForm.password,
      selectedRole,
      registerForm.mobile
    )
    
    const rolePath = {
      'Admin': '/admin',
      'Artist': '/artist',
      'Visitor': '/visitor',
      'Curator': '/curator',
    }[userData.role]
    
    navigate(rolePath)
  } catch (err) {
    setError(err.message)
  }
}

// Render role selection buttons
<div className="role-selection">
  <label className="role-label">Select Your Role</label>
  <div className="role-buttons">
    {ROLES.map((role) => (
      <button
        key={role.id}
        type="button"
        className={`role-btn ${selectedRole === role.id ? 'active' : ''}`}
        onClick={() => setSelectedRole(role.id)}
      >
        <span className="role-icon">{role.icon}</span>
        <span className="role-name">{role.label}</span>
      </button>
    ))}
  </div>
</div>

// ============================================================================
// FILE 3: src/components/ProtectedRoute.jsx
// ============================================================================

import { useContext } from 'react'
import { Navigate } from 'react-router-dom'
import { AuthContext } from '../context/AuthContext'

export default function ProtectedRoute({ children, requiredRole = null }) {
  const { user, loading } = useContext(AuthContext)

  if (loading) {
    return <div className="page" style={{ textAlign: 'center', padding: '3rem' }}>
      <p>ðŸ”„ Loading...</p>
    </div>
  }

  if (!user) {
    return <Navigate to="/" replace />
  }

  if (requiredRole && user.role !== requiredRole) {
    return <Navigate to="/" replace />
  }

  return children
}

// ============================================================================
// FILE 4: App.jsx - Route Setup
// ============================================================================

<Routes>
  <Route path="/" element={<Home />} />
  <Route path="/gallery" element={<Gallery />} />

  <Route
    path="/visitor"
    element={
      <ProtectedRoute requiredRole="Visitor">
        <VisitorDashboard {...props} />
      </ProtectedRoute>
    }
  />

  <Route
    path="/artist"
    element={
      <ProtectedRoute requiredRole="Artist">
        <ArtistDashboard {...props} />
      </ProtectedRoute>
    }
  />

  <Route
    path="/curator"
    element={
      <ProtectedRoute requiredRole="Curator">
        <CuratorDashboard {...props} />
      </ProtectedRoute>
    }
  />

  <Route
    path="/admin"
    element={
      <ProtectedRoute requiredRole="Admin">
        <AdminDashboard {...props} />
      </ProtectedRoute>
    }
  />

  <Route path="*" element={<Navigate to="/" replace />} />
</Routes>

// ============================================================================
// FILE 5: CSS - Role Selection Styles
// ============================================================================

.role-selection {
  margin: 1.5rem 0;
  padding: 1.5rem;
  background: linear-gradient(135deg, #eff6ff 0%, #f0fdf4 100%);
  border-radius: 12px;
  border: 2px solid #dbeafe;
}

.role-buttons {
  display: grid;
  grid-template-columns: repeat(auto-fit, minmax(110px, 1fr));
  gap: 0.75rem;
}

.role-btn {
  display: flex;
  flex-direction: column;
  align-items: center;
  justify-content: center;
  gap: 0.5rem;
  padding: 1rem;
  border: 2px solid #d1d5db;
  background: white;
  border-radius: 10px;
  cursor: pointer;
  transition: all 0.3s ease;
  font-weight: 600;
  color: #6b7280;
}

.role-btn:hover {
  border-color: #f97316;
  background: #fff7ed;
  transform: translateY(-2px);
  box-shadow: 0 4px 12px rgba(249, 115, 22, 0.15);
}

.role-btn.active {
  background: linear-gradient(135deg, #f97316, #ea580c);
  color: white;
  border-color: #f97316;
  box-shadow: 0 8px 20px rgba(249, 115, 22, 0.25);
}

.role-icon {
  font-size: 1.8rem;
  display: block;
}

// ============================================================================
// USAGE IN COMPONENTS
// ============================================================================

// Access user in any component
import { useContext } from 'react'
import { AuthContext } from '../context/AuthContext'

function MyComponent() {
  const { user, logout } = useContext(AuthContext)
  
  return (
    <div>
      <p>User: {user.name}</p>
      <p>Role: {user.role}</p>
      <button onClick={logout}>Logout</button>
    </div>
  )
}

// ============================================================================
// TESTING COMMANDS
// ============================================================================

# Start development server
npm run dev

# Build for production
npm run build

# Preview production build
npm run preview

// ============================================================================
// EXPECTED FLOW
// ============================================================================

1. User visits http://localhost:5173/
2. Home page shows role selection buttons
3. User selects role (Visitor/Creator/Curator/Admin)
4. User enters credentials
5. AuthContext.login() or .register() called with role
6. On success:
   - Token + user data stored in localStorage
   - User object with ROLE set in context
   - Auto-redirect to role-specific dashboard
7. On subsequent visits:
   - AuthContext restores user from localStorage
   - Dashboard renders based on role
   - Navbar shows role and user name

// ============================================================================
// KEY VARIABLES
// ============================================================================

user = {
  id: number,
  name: string,
  email: string,
  role: 'Admin' | 'Artist' | 'Visitor' | 'Curator'
}

token = JWT token string (stored in localStorage)

selectedRole = 'Visitor' | 'Artist' | 'Curator' | 'Admin'

// ============================================================================
